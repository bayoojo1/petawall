async function runVulnerabilityScan() {
    const url = document.getElementById('target-url').value;
    const scanType = document.getElementById('scan-type').value;
    
    if (!url) return alert('Please enter a target URL');
    
    // Show loading
    document.getElementById('vuln-loading').style.display = 'block';
    document.getElementById('vuln-results').style.display = 'none';
    document.getElementById('vuln-btn').disabled = true;
    document.getElementById('current-task').innerHTML = `${scanType.charAt(0).toUpperCase() + scanType.slice(1)} scan in progress...`;
    
    try {
        const formData = new FormData();
        formData.append('target', url);
        formData.append('scan_type', scanType);
        formData.append('tool', 'vulnerability');
        
        const response = await fetch('api.php', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        console.log('API Response:', data); // Debug log
        
        document.getElementById('vuln-loading').style.display = 'none';
        
        
        if (data.error) {
            alert('Error: ' + data.error);
            return;
        }
        
        if (!data.success) {
            alert('Scan failed: ' + (data.message || 'Unknown error'));
            return;
        }
        
        document.getElementById('vuln-results').style.display = 'block';
        document.getElementById('vuln-btn').disabled = false;
        displayVulnerabilityResults(data);
        
    } catch (error) {
        document.getElementById('vuln-loading').style.display = 'none';
        console.error('Request failed:', error);
        alert('Request failed: ' + error.message);
    }
}

function displayVulnerabilityResults(results) {
    console.log('Raw results:', results); // Debug log
    
    // Safely extract the actual data with proper error handling
    let data;
    
    // Handle different response structures
    if (results && results.data && results.data.data && results.data.data.vulnerabilities) {
        // Full scan structure: results.data.data.data
        data = results.data.data;
    } else if (results && results.data && results.data.vulnerabilities) {
        // Quick scan structure: results.data.data  
        data = results.data;
    } else if (results && results.vulnerabilities) {
        // Direct structure case (if API changes)
        data = results;
    } else {
        console.error('Unexpected data structure:', results);
        alert('Error: Unexpected response format from server');
        return;
    }
    
    console.log('Processed data:', data); // Debug log

    // Safe version of the problematic code:
    const scanType = data.scan_type || 'quick';
    const scanTitles = {
        'quick': 'Quick Scan Results',
        'full': 'Full Comprehensive Scan Results',
        'cms': 'CMS-Specific Scan Results', 
        'api': 'API Endpoints Scan Results'
    };

    // Safe DOM element updates
    const resultsHeader = document.querySelector('#vuln-results .results-header h3');
    if (resultsHeader) {
        resultsHeader.textContent = scanTitles[scanType] || 'Scan Results';
    }

    const scanSummary = document.getElementById('scan-summary');
    if (scanSummary) {
        const vulnCount = data.vulnerabilities ? data.vulnerabilities.length : 0;
        scanSummary.textContent = `${vulnCount} vulnerabilities found${scanType === 'full' ? ' (comprehensive scan)' : ''}`;
    }
    
    // Create the main results container with the new styling
    const resultsContainer = document.getElementById('vuln-results');
    
    // Clear and rebuild the results container with new structure
    resultsContainer.innerHTML = '';

    // Create header
    const header = document.createElement('header');
    header.className = 'header-vuln';

    // Calculate duration for all scan types - REUSE EXISTING VARIABLE
    let scanDuration = 'Unknown'; // Just assign, don't redeclare

    // Check multiple possible locations for duration data
    if (data.full_scan_details?.scan_duration) {
        // Full scan duration
        scanDuration = data.full_scan_details.scan_duration;
    } else if (data.scan_duration) {
        // Direct scan duration
        scanDuration = data.scan_duration;
    } else if (data.full_scan_details?.directory_enumeration?.scan_metrics?.scan_duration) {
        // Duration from directory enumeration metrics
        const durationInSeconds = data.full_scan_details.directory_enumeration.scan_metrics.scan_duration;
        if (durationInSeconds && typeof durationInSeconds === 'string') {
            const seconds = parseFloat(durationInSeconds);
            if (!isNaN(seconds)) {
                const minutes = Math.round(seconds / 60);
                scanDuration = `${minutes} minute${minutes !== 1 ? 's' : ''}`;
            }
        }
    } else if (data.website_info?.timestamp && data.timestamp) {
        // Calculate from timestamps
        try {
            const startTime = new Date(data.website_info.timestamp);
            const endTime = new Date(data.timestamp);
            const durationMs = endTime - startTime;
            const minutes = Math.floor(durationMs / (1000 * 60));
            const seconds = Math.floor((durationMs % (1000 * 60)) / 1000);
            
            if (minutes > 0) {
                scanDuration = `${minutes}m ${seconds}s`;
            } else {
                scanDuration = `${seconds}s`;
            }
        } catch (e) {
            scanDuration = 'Unknown';
        }
    } else {
        // Fallback based on scan type
        const estimatedDurations = {
            'quick': '1-2 minutes',
            'cms': '3-5 minutes',
            'api': '2-4 minutes',
            'full': '10-15 minutes'
        };
        scanDuration = estimatedDurations[scanType] || 'Unknown';
    }

    header.innerHTML = `
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <span>${scanType.charAt(0).toUpperCase() + scanType.slice(1)} Vulnerability Scanning</span>
            </div>
            <div class="scan-info">
                <div class="scan-info-item">
                    <i class="fas fa-globe"></i>
                    <span>Target: ${data.website_info?.url || 'Unknown'}</span>
                </div>
                <div class="scan-info-item">
                    <i class="fas fa-calendar"></i>
                    <span>Scan Date: ${new Date().toLocaleDateString('en-GB')}</span>
                </div>
            </div>
        </div>
    `;
    resultsContainer.appendChild(header);
    
    // Create main container
    const container = document.createElement('div');
    container.className = 'container';
    resultsContainer.appendChild(container);
    
    // Add summary cards
    const summaryCardsDiv = document.createElement('div');
    summaryCardsDiv.className = 'summary-cards-div';

    // Extract vulnerability counts from the actual data
    const vulnerabilities = data.vulnerabilities || [];
    const criticalCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'critical').length;
    const highCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'high').length;
    const mediumCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'medium').length;
    const lowCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'low').length;

    summaryCardsDiv.innerHTML = `
        <div class="summary-card critical">
            <i class="fas fa-skull-crossbones fa-2x" style="color: #dc3545;"></i>
            <div class="summary-count">${criticalCount}</div>
            <div class="summary-label">Critical</div>
        </div>
        <div class="summary-card high">
            <i class="fas fa-exclamation-triangle fa-2x" style="color: #fd7e14;"></i>
            <div class="summary-count">${highCount}</div>
            <div class="summary-label">High</div>
        </div>
        <div class="summary-card medium">
            <i class="fas fa-exclamation-circle fa-2x" style="color: #ffc107;"></i>
            <div class="summary-count">${mediumCount}</div>
            <div class="summary-label">Medium</div>
        </div>
        <div class="summary-card low">
            <i class="fas fa-info-circle fa-2x" style="color: #28a745;"></i>
            <div class="summary-count">${lowCount}</div>
            <div class="summary-label">Low</div>
        </div><br>
    `;
    container.appendChild(summaryCardsDiv);
    
    // Add chart container
    const chartContainer = document.createElement('div');
    chartContainer.className = 'chart-container';
    chartContainer.innerHTML = `
        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Vulnerability Distribution</h3>
        <div class="chart-wrapper">
            <canvas id="vuln-chart"></canvas>
        </div>
    `;
    container.appendChild(chartContainer);
    
    // Create vulnerabilities result card
    const vulnCard = document.createElement('div');
    vulnCard.className = 'result-card';
    vulnCard.innerHTML = '<h3>Vulnerabilities</h3>';
    container.appendChild(vulnCard);
    
    const vulnList = document.createElement('div');
    vulnList.id = 'vulnerabilities-list';
    vulnCard.appendChild(vulnList);
    
    // Display vulnerabilities
    if (data.vulnerabilities && data.vulnerabilities.length > 0) {
        data.vulnerabilities.forEach(vuln => {
            const vulnEl = document.createElement('div');
            vulnEl.className = `vuln-item ${vuln.severity ? vuln.severity.toLowerCase() : 'unknown'}`;
            vulnEl.innerHTML = `
                <div class="vuln-header">
                    <span class="risk-badge risk-${vuln.severity ? vuln.severity.toLowerCase() : 'unknown'}">
                        ${vuln.severity ? vuln.severity.toUpperCase() : 'UNKNOWN'}
                    </span>
                    <span class="cvss-score">CVSS: ${vuln.cvss_score || 'N/A'}</span>
                </div>
                <h4>${vuln.type || 'Unknown Type'}</h4>
                <p class="vuln-description">${vuln.description || 'No description available'}</p>
                <div class="vuln-details">
                    <div><strong>Location:</strong> ${vuln.location || 'Not specified'}</div>
                    <div><strong>Impact:</strong> ${vuln.impact || 'Not specified'}</div>
                </div>
                <div class="remediation">
                    <strong>Remediation:</strong> ${vuln.remediation || 'No remediation provided'}
                </div>
            `;
            vulnList.appendChild(vulnEl);
        });
        
        // Display full scan details if available
        if (scanType === 'full' && data.full_scan_details) {
            displayFullScanDetails(data.full_scan_details, vulnList);
        }
    } else {
        vulnList.innerHTML = `
            <div class="no-vulnerabilities" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                <i class="fas fa-check-circle" style="font-size: 3rem; color: #28a745; margin-bottom: 1rem;"></i>
                <p>No vulnerabilities found during ${scanType} scan</p>
            </div>
        `;
    }
    
    // Display recommendations
    const recommendationsCard = document.createElement('div');
    recommendationsCard.className = 'result-card';
    recommendationsCard.innerHTML = '<h3>Security Recommendations</h3>';
    container.appendChild(recommendationsCard);
    
    const recommendationsSection = document.createElement('div');
    recommendationsSection.className = 'scan-detail-section';
    recommendationsCard.appendChild(recommendationsSection);
    
    const recommendationsList = document.createElement('ul');
    recommendationsList.className = 'recommendations-list';
    
    if (data.recommendations && data.recommendations.length > 0) {
        data.recommendations.forEach(rec => {
            const recEl = document.createElement('li');
            recEl.innerHTML = `<i class="fas fa-chevron-right"></i> ${rec}`;
            recommendationsList.appendChild(recEl);
        });
    } else {
        recommendationsList.innerHTML = '<div class="no-recommendations">No recommendations available</div>';
    }
    recommendationsSection.appendChild(recommendationsList);

    // Add scan metadata - USING ACTUAL DATA
    const metaSection = document.createElement('div');
    metaSection.className = 'scan-meta-section';

    // Calculate actual duration and get real test counts
    // scanDuration = 'Unknown';
    let testsPerformed = 'N/A';

    // Method 1: Use data from full_scan_details if available
    if (data.full_scan_details) {
        scanDuration = data.full_scan_details.scan_duration || 'Unknown';
        testsPerformed = data.full_scan_details.tests_performed || 'N/A';
    } 
    // Method 2: Calculate from scan timestamps if available
    else if (data.website_info?.timestamp) {
        const scanStart = new Date(data.website_info.timestamp);
        const scanEnd = new Date(data.timestamp || new Date());
        const durationMs = scanEnd - scanStart;
        const durationMinutes = Math.round(durationMs / (1000 * 60));
        scanDuration = `${durationMinutes} minute${durationMinutes !== 1 ? 's' : ''}`;
    }
    // Method 3: Use scan_type to estimate if no timing data available
    else {
        const estimatedDurations = {
            'quick': '1-2 minutes',
            'cms': '3-5 minutes', 
            'api': '2-4 minutes',
            'full': '10-15 minutes'
        };
        scanDuration = estimatedDurations[scanType] || 'Unknown';
    }

    // Get actual test counts from the data structure
    if (data.full_scan_details?.directory_enumeration?.scan_metrics?.total_tests_performed) {
        testsPerformed = data.full_scan_details.directory_enumeration.scan_metrics.total_tests_performed;
    } else if (data.vulnerabilities) {
        // Estimate based on vulnerabilities found and scan type
        const baseTests = {
            'quick': 15,
            'cms': 25,
            'api': 20,
            'full': 30
        };
        testsPerformed = baseTests[scanType] || data.vulnerabilities.length * 5;
    }

    metaSection.innerHTML = `
        <div class="scan-meta">
            <span><i class="fas fa-clock"></i> Duration: ${scanDuration}</span>
            <span><i class="fas fa-tasks"></i> Tests: ${testsPerformed}</span>
        </div>
    `;
    container.appendChild(metaSection);

// Create chart
    setTimeout(() => {
        const ctx = document.getElementById('vuln-chart').getContext('2d');
        
        // Destroy existing chart if it exists
        if (window.vulnChart instanceof Chart) {
            window.vulnChart.destroy();
        }

        // Use actual vulnerability counts for the chart
        const vulnerabilities = data.vulnerabilities || [];
        const criticalCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'critical').length;
        const highCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'high').length;
        const mediumCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'medium').length;
        const lowCount = vulnerabilities.filter(v => v.severity?.toLowerCase() === 'low').length;

        window.vulnChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Critical', 'High', 'Medium', 'Low'],
                datasets: [{
                    data: [criticalCount, highCount, mediumCount, lowCount],
                    backgroundColor: ['#dc2626', '#ea580c', '#d97706', '#65a30d'],
                    borderColor: ['#fff', '#fff', '#fff', '#fff'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 10
                        }
                    },
                plugins: {
                    legend: { 
                        position: 'bottom',
                        labels: {
                            color: '#212529', // Changed from white to dark color
                            font: {
                                size: 12,
                                weight: 'bold'
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Vulnerability Severity Distribution',
                        color: '#212529', // Changed from white to dark color
                        font: {
                            size: 16,
                            weight: 'bold'
                        }
                    }
                }
            }
        });
    }, 100);
}

// Function to display additional full scan details
function displayFullScanDetails(details, vulnList) {
    // Display technology stack analysis first (most important)
    if (details.technology_stack) {
        displayTechnologyStackAnalysis(details.technology_stack, vulnList);
    }
    
    // Display directory enumeration results
    if (details.directory_enumeration) {
        displayDirectoryEnumerationResults(details.directory_enumeration, vulnList);
    }
    
    // Display port scan results
    if (details.open_ports && details.open_ports.length > 0) {
        const portScanEl = document.createElement('div');
        portScanEl.className = 'scan-detail-section';
        portScanEl.innerHTML = `
            <h4><i class="fas fa-network-wired"></i> Port Scan Results</h4>
            <div class="port-list">
                ${details.open_ports.map(port => `
                    <span class="port-item ${port.status === 'open' ? 'open' : 'closed'}">
                        Port ${port.port}/${port.protocol || 'tcp'} - ${port.service || 'Unknown'} (${port.status})
                    </span>
                `).join('')}
            </div>
        `;
        vulnList.appendChild(portScanEl);
    }
    
    // Display SSL certificate check
    if (details.ssl_certificate) {
        const sslEl = document.createElement('div');
        sslEl.className = 'scan-detail-section';
        
        let sslContent = '<h4><i class="fas fa-lock"></i> SSL Certificate Check</h4>';
        if (details.ssl_certificate.error) {
            sslContent += `<div class="ssl-error">SSL Check Failed: ${details.ssl_certificate.error}</div>`;
        } else {
            sslContent += `
                <div class="ssl-details">
                    <div><strong>Valid:</strong> ${details.ssl_certificate.valid ? 'Yes' : 'No'}</div>
                    <div><strong>Issuer:</strong> ${details.ssl_certificate.issuer || 'Unknown'}</div>
                    <div><strong>Expires:</strong> ${details.ssl_certificate.expires || 'Unknown'}</div>
                    <div><strong>Days Remaining:</strong> ${details.ssl_certificate.days_remaining || 'Unknown'}</div>
                    ${details.ssl_certificate.subject ? `<div><strong>Subject:</strong> ${details.ssl_certificate.subject}</div>` : ''}
                </div>
            `;
        }
        
        sslEl.innerHTML = sslContent;
        vulnList.appendChild(sslEl);
    }
    
    // Display DNS security
    if (details.dns_security) {
        const dnsEl = document.createElement('div');
        dnsEl.className = 'scan-detail-section';
        dnsEl.innerHTML = `
            <h4><i class="fas fa-globe"></i> DNS Security</h4>
            <div class="dns-details">
                <div><strong>DNSSEC:</strong> ${details.dns_security.dnssec || 'Not checked'}</div>
                <div><strong>SPF:</strong> ${details.dns_security.spf || 'Not checked'}</div>
                <div><strong>DMARC:</strong> ${details.dns_security.dmarc || 'Not checked'}</div>
                <div><strong>DKIM:</strong> ${details.dns_security.dkim || 'Not checked'}</div>
                ${details.dns_security.note ? `<div class="dns-note">${details.dns_security.note}</div>` : ''}
            </div>
        `;
        vulnList.appendChild(dnsEl);
    }
}

// Function to display technology stack analysis
function displayTechnologyStackAnalysis(techStack, vulnList) {
    const techEl = document.createElement('div');
    techEl.className = 'scan-detail-section technology-stack';
    
    let techContent = '<h4><i class="fas fa-layer-group"></i> Technology Stack Analysis</h4>';
    
    // Web Server
    if (techStack.web_server && techStack.web_server.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-server"></i> Web Server</h5>
                <div class="tech-items">
                    ${techStack.web_server.map(server => `<span class="tech-item">${server}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Programming Languages
    if (techStack.programming_languages && techStack.programming_languages.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-code"></i> Programming Languages</h5>
                <div class="tech-items">
                    ${techStack.programming_languages.map(lang => `<span class="tech-item">${lang}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Frameworks
    if (techStack.frameworks && techStack.frameworks.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-cubes"></i> Frameworks</h5>
                <div class="tech-items">
                    ${techStack.frameworks.map(framework => `<span class="tech-item">${framework}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Database Technologies
    if (techStack.database_technologies && techStack.database_technologies.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-database"></i> Database Technologies</h5>
                <div class="tech-items">
                    ${techStack.database_technologies.map(db => `<span class="tech-item">${db}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Caching Technologies
    if (techStack.caching_technologies && techStack.caching_technologies.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-bolt"></i> Caching Technologies</h5>
                <div class="tech-items">
                    ${techStack.caching_technologies.map(cache => `<span class="tech-item">${cache}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // CDN Providers
    if (techStack.cdn_providers && techStack.cdn_providers.length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-cloud"></i> CDN Providers</h5>
                <div class="tech-items">
                    ${techStack.cdn_providers.map(cdn => `<span class="tech-item">${cdn}</span>`).join('')}
                </div>
            </div>
        `;
    }
    
    // Version Information
    if (techStack.version_information && Object.keys(techStack.version_information).length > 0) {
        techContent += `
            <div class="tech-category">
                <h5><i class="fas fa-info-circle"></i> Version Information</h5>
                <div class="version-items">
                    ${Object.entries(techStack.version_information).map(([tech, version]) => 
                        `<div class="version-item"><strong>${tech}:</strong> ${Array.isArray(version) ? version.join(', ') : version}</div>`
                    ).join('')}
                </div>
            </div>
        `;
    }
    
    // Security Implications
    if (techStack.security_implications && techStack.security_implications.length > 0) {
        techContent += `
            <div class="tech-category security-implications">
                <h5><i class="fas fa-shield-alt"></i> Security Implications</h5>
                <div class="implication-items">
                    ${techStack.security_implications.map(implication => 
                        `<div class="implication-item"><i class="fas fa-exclamation-triangle"></i> ${implication}</div>`
                    ).join('')}
                </div>
            </div>
        `;
    }
    
    techEl.innerHTML = techContent;
    vulnList.appendChild(techEl);
}

// Function to display directory enumeration results
function displayDirectoryEnumerationResults(enumeration, vulnList) {
    const enumEl = document.createElement('div');
    enumEl.className = 'scan-detail-section directory-enumeration';
    
    let enumContent = '<h4><i class="fas fa-folder-tree"></i> Directory & File Enumeration</h4>';
    
    // Common Directories
    if (enumeration.common_directories && enumeration.common_directories.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-folder"></i> Common Directories Found</h5>
                <div class="enum-items">
                    ${enumeration.common_directories.map(dir => `
                        <div class="enum-item ${dir.risk || 'low'}">
                            <span class="enum-path">${dir.path}</span>
                            <span class="enum-status">${dir.status}</span>
                            ${dir.risk ? `<span class="risk-indicator risk-${dir.risk}">${dir.risk.toUpperCase()}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Hidden Files
    if (enumeration.hidden_files && enumeration.hidden_files.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-eye-slash"></i> Hidden Files Found</h5>
                <div class="enum-items">
                    ${enumeration.hidden_files.map(file => `
                        <div class="enum-item ${file.risk || 'medium'}">
                            <span class="enum-path">${file.path}</span>
                            <span class="enum-status">${file.status}</span>
                            ${file.risk ? `<span class="risk-indicator risk-${file.risk}">${file.risk.toUpperCase()}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Backup Files
    if (enumeration.backup_files && enumeration.backup_files.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-archive"></i> Backup Files Found</h5>
                <div class="enum-items">
                    ${enumeration.backup_files.map(backup => `
                        <div class="enum-item ${backup.risk || 'high'}">
                            <span class="enum-path">${backup.path}</span>
                            <span class="enum-status">${backup.status}</span>
                            <span class="risk-indicator risk-${backup.risk || 'high'}">${(backup.risk || 'high').toUpperCase()}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Config Files
    if (enumeration.config_files && enumeration.config_files.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-cog"></i> Configuration Files Found</h5>
                <div class="enum-items">
                    ${enumeration.config_files.map(config => `
                        <div class="enum-item ${config.risk || 'critical'}">
                            <span class="enum-path">${config.path}</span>
                            <span class="enum-status">${config.status}</span>
                            <span class="risk-indicator risk-${config.risk || 'critical'}">CRITICAL</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Log Files
    if (enumeration.log_files && enumeration.log_files.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-clipboard-list"></i> Log Files Found</h5>
                <div class="enum-items">
                    ${enumeration.log_files.map(log => `
                        <div class="enum-item ${log.risk || 'high'}">
                            <span class="enum-path">${log.path}</span>
                            <span class="enum-status">${log.status}</span>
                            <span class="risk-indicator risk-${log.risk || 'high'}">HIGH</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Admin Interfaces
    if (enumeration.admin_interfaces && enumeration.admin_interfaces.length > 0) {
        enumContent += `
            <div class="enum-category">
                <h5><i class="fas fa-user-shield"></i> Admin Interfaces Found</h5>
                <div class="enum-items">
                    ${enumeration.admin_interfaces.map(admin => `
                        <div class="enum-item ${admin.risk || 'medium'}">
                            <span class="enum-path">${admin.path}</span>
                            <span class="enum-status">${admin.status}</span>
                            <span class="risk-indicator risk-${admin.risk || 'medium'}">MEDIUM</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Summary statistics
    const totalFound = [
        ...(enumeration.common_directories || []),
        ...(enumeration.hidden_files || []),
        ...(enumeration.backup_files || []),
        ...(enumeration.config_files || []),
        ...(enumeration.log_files || []),
        ...(enumeration.admin_interfaces || [])
    ].length;
    
    if (totalFound > 0) {
        enumContent += `
            <div class="enum-summary">
                <strong>Total items found:</strong> ${totalFound}
            </div>
        `;
    } else {
        enumContent += `
            <div class="no-enumeration">
                <i class="fas fa-check-circle"></i> No sensitive directories or files found
            </div>
        `;
    }
    
    enumEl.innerHTML = enumContent;
    vulnList.appendChild(enumEl);
}